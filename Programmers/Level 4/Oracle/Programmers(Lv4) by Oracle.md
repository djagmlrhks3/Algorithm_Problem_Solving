# Programmers(Lv4) by Oracle

### 우유와 요거트가 담긴 장바구니

```SQL
SELECT CART_ID
  FROM CART_PRODUCTS
 WHERE NAME = 'Milk' 
   AND CART_ID IN (SELECT CART_ID FROM CART_PRODUCTS WHERE NAME = 'Yogurt')
 ORDER BY CART_ID
```



### 입양 시각 구하기(2)

> CONNECT BY

```mysql
SELECT A.HOUR, COUNT(B.HOUR)
  FROM (SELECT LEVEL-1 AS HOUR
          FROM DUAL
       CONNECT BY LEVEL <= 24) A,
       (SELECT TO_CHAR(DATETIME, 'HH24') AS HOUR
          FROM ANIMAL_OUTS) B
 WHERE A.HOUR = B.HOUR(+)
 GROUP BY A.HOUR
 ORDER BY A.HOUR
```



>WITH AS & RECURSIVE

```SQL
WITH TIME(H) AS (
  SELECT 0
    FROM DUAL
   UNION ALL
  SELECT H+1
    FROM TIME
   WHERE H < 23
)
SELECT A.H AS HOUR, COUNT(B.HOUR) AS COUNT
  FROM TIME A,
       (SELECT TO_CHAR(DATETIME, 'HH24') AS HOUR
          FROM ANIMAL_OUTS) B
 WHERE A.H = B.HOUR(+)
 GROUP BY A.H
 ORDER BY A.H
```



### 보호소에서 중성화한 동물

```SQL
SELECT A.ANIMAL_ID, A.ANIMAL_TYPE, A.NAME
  FROM ANIMAL_INS A,
       ANIMAL_OUTS B
 WHERE A.ANIMAL_ID = B.ANIMAL_ID
   AND A.SEX_UPON_INTAKE LIKE '%Intact%'
   AND (B.SEX_UPON_OUTCOME LIKE '%Spayed%' OR B.SEX_UPON_OUTCOME LIKE '%Neutered%')
 ORDER BY A.ANIMAL_ID
```



### 식품분류별 가장 비싼 식품의 정보 조회하기

```SQL
SELECT A.CATEGORY, B.MAX_PRICE, A.PRODUCT_NAME
  FROM FOOD_PRODUCT A
      ,(SELECT CATEGORY, MAX(PRICE) MAX_PRICE
          FROM FOOD_PRODUCT
         WHERE CATEGORY IN ('과자', '국', '김치', '식용유')
         GROUP BY CATEGORY) B
 WHERE A.CATEGORY = B.CATEGORY
   AND A.PRICE = B.MAX_PRICE
 ORDER BY 2 DESC
```



### 5월 식품들의 총매출 조회하기

```SQL
SELECT A.PRODUCT_ID
      ,A.PRODUCT_NAME
      ,SUM(A.PRICE * B.AMOUNT) TOTAL_SALES
  FROM FOOD_PRODUCT A
      ,FOOD_ORDER B
 WHERE A.PRODUCT_ID = B.PRODUCT_ID
   AND TO_CHAR(B.PRODUCE_DATE, 'YYYYMM') = '202205'
 GROUP BY A.PRODUCT_ID, A.PRODUCT_NAME
 ORDER BY TOTAL_SALES DESC, PRODUCT_ID
```



### 년, 월, 성별 별 상품 구매 회원 수 구하기

```SQL
SELECT TO_CHAR(SALES_DATE, 'YYYY') YEAR
      ,TO_CHAR(SALES_DATE, 'MM') MONTH
      ,A.GENDER
      ,COUNT(DISTINCT B.USER_ID) USERS
  FROM USER_INFO A
      ,ONLINE_SALE B
 WHERE A.USER_ID = B.USER_ID
   AND A.GENDER IS NOT NULL
 GROUP BY TO_CHAR(SALES_DATE, 'YYYY'), TO_CHAR(SALES_DATE, 'MM'), A.GENDER
 ORDER BY 1, 2, 3
```



### 서울에 위치한 식당 목록 출력하기

```SQL
SELECT A.REST_ID
      ,A.REST_NAME
      ,A.FOOD_TYPE
      ,A.FAVORITES
      ,A.ADDRESS
      ,ROUND(AVG(B.REVIEW_SCORE), 2) SCORE
  FROM REST_INFO A
      ,REST_REVIEW B
 WHERE A.REST_ID = B.REST_ID
   AND A.ADDRESS LIKE '서울%'
 GROUP BY A.REST_ID, A.REST_NAME, A.FOOD_TYPE, A.FAVORITES, A.ADDRESS
 ORDER BY 6 DESC, 4 DESC
```



### 취소되지 않은 진료 예약 조회하기

```SQL
SELECT C.APNT_NO
      ,A.PT_NAME
      ,A.PT_NO
      ,C.MCDP_CD
      ,B.DR_NAME
      ,C.APNT_YMD
  FROM PATIENT A
      ,DOCTOR B
      ,APPOINTMENT C
 WHERE A.PT_NO = C.PT_NO
   AND B.DR_ID = C.MDDR_ID
   AND C.MCDP_CD = 'CS'
   AND C.APNT_CNCL_YN = 'N'
   AND TO_CHAR(C.APNT_YMD, 'YYYYMMDD') = '20220413'
 ORDER BY 6
```



### 주문량이 많은 아이스크림들 조회하기

```SQL
SELECT FLAVOR
  FROM (SELECT A.FLAVOR, SUM(A.TOTAL_ORDER + B.TOTAL_ORDER)
          FROM FIRST_HALF A
              ,JULY B
         WHERE A.FLAVOR = B.FLAVOR
         GROUP BY A.FLAVOR
         ORDER BY 2 DESC)
 WHERE ROWNUM <= 3
```



### 오프라인/온라인 판매 데이터 통합하기

```SQL
SELECT TO_CHAR(SALES_DATE, 'YYYY-MM-DD') SALES_DATE
      ,PRODUCT_ID
      ,USER_ID
      ,SALES_AMOUNT
  FROM ONLINE_SALE
 WHERE TO_CHAR(SALES_DATE, 'YYYYMM') = '202203'  
 UNION
SELECT TO_CHAR(SALES_DATE, 'YYYY-MM-DD') SALES_DATE
      ,PRODUCT_ID
      ,NULL
      ,SALES_AMOUNT
  FROM OFFLINE_SALE
 WHERE TO_CHAR(SALES_DATE, 'YYYYMM') = '202203'
 ORDER BY 1, 2, 3
```



### 저자 별 카테고리 별 매출액 집계하기

```SQL
SELECT B.AUTHOR_ID
      ,B.AUTHOR_NAME
      ,A.CATEGORY
      ,SUM(A.PRICE * C.SALES) TOTAL_SALES
  FROM BOOK A
      ,AUTHOR B
      ,BOOK_SALES C
 WHERE A.AUTHOR_ID = B.AUTHOR_ID
   AND A.BOOK_ID = C.BOOK_ID
   AND TO_CHAR(C.SALES_DATE, 'YYYYMM') = '202201'
 GROUP BY B.AUTHOR_ID, B.AUTHOR_NAME, A.CATEGORY 
 ORDER BY 1, 3 DESC
```



### 그룹별 조건에 맞는 식당 목록 출력하기

```SQL
SELECT A.MEMBER_NAME, B.REVIEW_TEXT, TO_CHAR(B.REVIEW_DATE, 'YYYY-MM-DD') AS REVIEW_DATE
  FROM MEMBER_PROFILE A
      ,REST_REVIEW B
 WHERE A.MEMBER_ID = B.MEMBER_ID
   AND A.MEMBER_ID IN (SELECT MEMBER_ID
                         FROM REST_REVIEW
                        GROUP BY MEMBER_ID
                        HAVING COUNT(*) = (SELECT MAX(COUNT(*)) 
                                             FROM REST_REVIEW
                                            GROUP BY MEMBER_ID))
 ORDER BY 3, 2
```



### 자동차 대여 기록 별 대여 금액 구하기

```SQL
SELECT B.HISTORY_ID
      ,(A.DAILY_FEE * B.DIFF) * (100-NVL(C.DISCOUNT_RATE, 0)) * (0.01) FEE
  FROM CAR_RENTAL_COMPANY_CAR A
      ,(SELECT X.*
              ,X.END_DATE-X.START_DATE+1 DIFF
              ,CASE WHEN X.END_DATE-X.START_DATE <  7 THEN '7일 이하'
                    WHEN X.END_DATE-X.START_DATE < 30 THEN '7일 이상'
                    WHEN X.END_DATE-X.START_DATE < 90 THEN '30일 이상'
                    ELSE '90일 이상'
                    END DURATION
          FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY X) B
      ,CAR_RENTAL_COMPANY_DISCOUNT_PLAN C
 WHERE A.CAR_ID = B.CAR_ID
   AND A.CAR_TYPE = C.CAR_TYPE(+)
   AND A.CAR_TYPE = '트럭'
   AND B.DURATION = C.DURATION_TYPE(+)
 ORDER BY 2 DESC, 1 DESC
```

